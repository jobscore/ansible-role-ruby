---
language: python
services: docker

env:
  - distro: ubuntu1604
  - distro: ubuntu1404

script:
  - export container_id=$(date +%s)
  - export cleanup=false
  # Download test shim.
  - wget -O ${PWD}/tests/test.sh https://gist.githubusercontent.com/geerlingguy/73ef1e5ee45d8694570f334be385e181/raw/
  - chmod +x ${PWD}/tests/test.sh

  # Run tests.
  - ${PWD}/tests/test.sh

  - 'docker exec --tty ${container_id} env TERM=xterm service awslogs status'
  - 'docker exec --tty ${container_id} env TERM=xterm cat /var/log/awslogs.log'
  - 'docker exec --tty ${container_id} env TERM=xterm cat /var/awslogs/awslogs.conf'

notifications:
  email: false
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
  slack:
    rooms:
    template:
      - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository}@%{branch} by %{author} %{result} in %{elapsed_time} "
      - "PR: <%{pull_request_url}|#%{pull_request_number}> "
      - "Total build time: %{duration}"
