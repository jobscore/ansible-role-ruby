---
# Install Ruby

- name: Ensure APT dependencies are installed
  apt:
    name: "{{ item }}"
    state: present
    install_recommends: yes
  with_items:
    - build-essential
    - curl
    - git
    - libc6-dev
    - libreadline-dev
    - libreadline6-dev
    - libsqlite3-dev
    - libssl-dev
    - libxml2-dev
    - libxslt-dev
    - libyaml-dev
    - make
    - sqlite3
    - zlib1g-dev

- name: Clone ruby-build repo
  git:
    repo: "{{ ruby_build_repo }}"
    dest: /tmp/ruby-build
    depth: 1

- name: Install ruby-build
  command: "/tmp/ruby-build/install.sh creates={{ ruby_path }}/ruby-build"

- name: Install ruby
  command: "{{ ruby_path }}/ruby-build {{ ruby_version }} {{ ruby_path }}"
